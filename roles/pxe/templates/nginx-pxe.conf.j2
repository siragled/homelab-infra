# Nginx configuration for PXE HTTP server
# Generated by Ansible - do not edit manually

server {
    listen {{ pxe_http_port }};
    listen [::]:{{ pxe_http_port }};
    
    server_name {{ ansible_fqdn }} {{ ansible_hostname }} {{ pxe_next_server }};
    
    root {{ pxe_http_root }};
    index index.html index.htm;
    
    # Enable directory browsing for easier debugging
    autoindex on;
    autoindex_exact_size off;
    autoindex_localtime on;
    
    # Optimize for serving large files
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    
    # Gzip compression for text files
    gzip on;
    gzip_vary on;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json;
    
    # Cache static files
    location ~* \.(iso|img|vmlinuz|initrd)$ {
        expires 1d;
        add_header Cache-Control "public, immutable";
    }
    
    # Logging
    access_log /var/log/nginx/pxe-access.log;
    error_log /var/log/nginx/pxe-error.log;
    
    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";
}
